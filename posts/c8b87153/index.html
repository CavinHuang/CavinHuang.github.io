<!DOCTYPE html><html lang="zh"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"><meta name="baidu-site-verification" content="rqskM4bdtP"><meta name="viewport" content="device-width, initial-scale=1, maximum-scale=1,user-scalable=no"><title>centos7 源码编译安装mysql5.7-CavinHuangのBlog-http://blog.zukmb.cn</title><meta name="keywords" content="前端学习,php学习,个人博客,HTML,CSS,JS"><meta name="description" content="cavinHuang个人博客，这里记录学习和生活的点滴！"><meta name="google-site-verification" content="zOYxWUgmeogC0qY76WLP0eWl8r9E8jk_qU927Ij7tbs"><script type="text/javascript" src="//s7.addthis.com/js/300/addthis_widget.js#pubid=ra-5a4c3745fa28006f"></script><link rel="stylesheet" href="/css/yoyo.css"><link rel="icon" href="/img/favicon.png"><link rel="stylesheet" href="https://cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css?version=1.3"><script src="//cdn.bootcss.com/jquery/3.2.1/jquery.min.js"></script><script src="//cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script><script src="https://cdn.bootcss.com/velocity/1.5.0/velocity.min.js"></script><meta name="generator" content="Hexo 5.3.0"><link rel="stylesheet" href="/css/prism-base16-ateliersulphurpool.light.css" type="text/css"><link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head><body></body></html><div class="app"><div class="left-container"><div class="left-layout-container pc"><div class="user-info"><a href="/"><img src="https://avatars1.githubusercontent.com/u/24950299?s=460&amp;v=4"></a><div class="login-name">CavinHuang</div><div class="slog">来不及总结自己,愿天大地大,我独一无二!</div></div><ul class="other-site"><li><img src="http://www.17sucai.com/preview/177065/2017-09-28/Mon9/static/img/github.png"></li><li><img src="http://www.17sucai.com/preview/177065/2017-09-28/Mon9/static/img/weibo.png"></li></ul><ul class="left-menu"><li><a href="/archives">文章</a></li><li><a href="/categories">分类</a></li><li><a href="/tags">标签</a></li><li><a href="/about">关于</a></li></ul><div class="qq-group"><span>读万卷书</span><span>行万里路</span></div><div class="copyright">@ 2017 - 2017 CavinHuang</div></div></div><div id="app-aside"><aside class="aside"><div class="aside-user"><div class="avatar"><img src="https://avatars1.githubusercontent.com/u/24950299?s=460&amp;v=4" alt="CavinHuang"></div><div class="profile"><h3 class="name">CavinHuang</h3><p class="email">来不及总结自己,愿天大地大,我独一无二!</p></div></div><div class="aside-nav"><nav class="nav-list"><a class="item" href="/archives"><span>文章</span></a><a class="item" href="/categories"><span>分类</span></a><a class="item" href="/tags"><span>标签</span></a><a class="item" href="/about"><span>关于</span></a></nav></div></aside></div><div class="blog-container main-container" id="content-outer"><nav class="navbar"><div class="navbar-container"><div class="navbar-header"><a class="navbar-menu" id="navMenu" href="javascript:;" data-isOpen="false"><i class="iconfont icon-menu"></i></a><a class="navbar-logo" href="/"><img src="/assets/img/logo.png"></a><a class="navbar-search" href=""></a></div></div></nav><div class="blog-list-container" id="content-inner"><article class="article-container" id="post"><div class="article-header"><h1 class="article-title">centos7 源码编译安装mysql5.7</h1><div class="article-subtitle"><div class="publish-time fl">发布时间:<span>2018/5/5 13:58:3</span></div><div class="categories">分类:<a href="/categories/server/"><span>服务器操作</span></a>/<a href="/categories/server/mysql/"><span>mysql</span></a></div></div></div><div class="article-word-count"><ul><div class="word-count-item">全文约<span class="post-count">1.2k</span>字</div><div class="word-count-item">预计需要<span class="post-count">5</span>分钟</div></ul></div><div class="article-content"><h2 id="1-准备工作"><a href="#1-准备工作" class="headerlink" title="1.准备工作"></a>1.准备工作</h2><p>首先需要准备mysql的源码包，最新版本是5.7.12<br>下载地址为：<br><a target="_blank" rel="noopener" href="http://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.12.tar.gz">http://cdn.mysql.com//Downloads/MySQL-5.7/mysql-5.7.12.tar.gz</a></p><a id="more"></a><p>同时，mysql 5.7需要boost 1.59以及以上版本，需要在sourceforge上下载。地址为：<br><a target="_blank" rel="noopener" href="http://www.boost.org/users/download/">http://www.boost.org/users/download/</a></p><p>安装之前最好检查一下是否已安装了mysql和boost</p><pre class="line-numbers language-bash"><code class="language-bash">rpm -qa <span class="token operator">|</span> <span class="token function">grep</span> mysql    <span class="token comment" spellcheck="true">#查看系统自带mysql</span>
yum -y remove mysql-*   <span class="token comment" spellcheck="true">#卸载mysql</span>
rpm -e --nodeps mysql-5.1.73-3.el6_5.x86_64 <span class="token comment" spellcheck="true">#卸载mysql</span>
rpm -qa <span class="token operator">|</span> <span class="token function">grep</span> boost    <span class="token comment" spellcheck="true">#查看系统自带boost</span>
yum -y remove boost-*   <span class="token comment" spellcheck="true">#卸载boost</span>
rpm -e --nodeps boost-filesystem-1.41.0-11.el6_1.2.x86_64 <span class="token comment" spellcheck="true">#卸载boost</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><p>然后安装其它得依赖包：</p><pre class="line-numbers language-bash"><code class="language-bash">yum <span class="token function">install</span> gcc gcc-c++ ncurses ncurses-devel bison libgcrypt perl cmake<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="2-准备安装"><a href="#2-准备安装" class="headerlink" title="2.准备安装"></a>2.准备安装</h2><p>首先将boost库解压出来</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">tar</span> -zxvf boost_1_59_0.tar.gz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后拷贝到一个目录中</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">mv</span> boost_1_59_0 /usr/local/boost<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后创建用户组以及用户</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cat</span> /etc/group <span class="token operator">|</span> <span class="token function">grep</span> mysql     <span class="token comment" spellcheck="true">#查看是否存在mysql用户组</span>
<span class="token function">cat</span> /etc/passwd <span class="token operator">|</span> <span class="token function">grep</span> mysql    <span class="token comment" spellcheck="true">#查看是否存在mysql用户</span>
<span class="token function">groupadd</span> mysql                  <span class="token comment" spellcheck="true">#创建用户组</span>
<span class="token function">useradd</span> -r -g mysql mysql       <span class="token comment" spellcheck="true">#创建用户</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>上面得工作完成以后，就可以开始编译mysql了，当然，先将mysql的源码解压出来：</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">tar</span> xzvf mysql-5.7.12.tar.gz
<span class="token function">cd</span> mysql-5.7.12<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>使用cmake和make命令来进行编译</p><pre class="line-numbers language-bash"><code class="language-bash">cmake <span class="token keyword">.</span> -DCMAKE_INSTALL_PREFIX<span class="token operator">=</span>/usr/local/mysql -DMYSQL_DATADIR<span class="token operator">=</span>/usr/local/mysql/data -DDEFAULT_CHARSET<span class="token operator">=</span>utf8 -DDEFAULT_COLLATION<span class="token operator">=</span>utf8_general_ci -DMYSQL_TCP_PORT<span class="token operator">=</span>3306 -DMYSQL_USER<span class="token operator">=</span>mysql -DWITH_MYISAM_STORAGE_ENGINE<span class="token operator">=</span>1 -DWITH_INNOBASE_STORAGE_ENGINE<span class="token operator">=</span>1 -DWITH_ARCHIVE_STORAGE_ENGINE<span class="token operator">=</span>1 -DWITH_BLACKHOLE_STORAGE_ENGINE<span class="token operator">=</span>1 -DWITH_MEMORY_STORAGE_ENGINE<span class="token operator">=</span>1 -DENABLE_DOWNLOADS<span class="token operator">=</span>1 -DDOWNLOAD_BOOST<span class="token operator">=</span>1 -DWITH_BOOST<span class="token operator">=</span>/usr/local/boost

<span class="token function">make</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>编译会消耗较多的时间，期间可以喝杯茶，或者来创建几个目录，因为我们指定编译参数得时候，指定了mysql得数据存储的目录，因此，这个时候可以先把目录都创建出来：</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">mkdir</span> /usr/local/mysql
<span class="token function">mkdir</span> /usr/local/mysql/data
<span class="token function">mkdir</span> /usr/local/mysql/logs
<span class="token function">mkdir</span> /usr/local/mysql/pids<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>最后还有重要得一步，需要将目录得所有权交给mysql用户</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">chown</span> -R mysql:mysql /usr/local/mysql  <span class="token comment" spellcheck="true">#需要root权限</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>编译完成后执行make install 安装即可<br>随后，我们需要配置/etc/my.cnf文件：</p><pre class="line-numbers language-bash"><code class="language-bash">vim /etc/my.cnf                                          <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后写入参数，最终如下；</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token comment" spellcheck="true"># For advice on how to change settings please see</span>
<span class="token comment" spellcheck="true"># http://dev.mysql.com/doc/refman/5.7/en/server-configuration-defaults.html</span>

<span class="token punctuation">[</span>mysqld<span class="token punctuation">]</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Remove leading # and set to the amount of RAM for the most important data</span>
<span class="token comment" spellcheck="true"># cache in MySQL. Start at 70% of total RAM for dedicated server, else 10%.</span>
<span class="token comment" spellcheck="true"># innodb_buffer_pool_size = 128M</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Remove leading # to turn on a very important data integrity option: logging</span>
<span class="token comment" spellcheck="true"># changes to the binary log between backups.</span>
<span class="token comment" spellcheck="true"># log_bin</span>
<span class="token comment" spellcheck="true">#</span>
<span class="token comment" spellcheck="true"># Remove leading # to set options mainly useful for reporting servers.</span>
<span class="token comment" spellcheck="true"># The server defaults are faster for transactions and fast SELECTs.</span>
<span class="token comment" spellcheck="true"># Adjust sizes as needed, experiment to find the optimal values.</span>
<span class="token comment" spellcheck="true"># join_buffer_size = 128M</span>
<span class="token comment" spellcheck="true"># sort_buffer_size = 2M</span>
<span class="token comment" spellcheck="true"># read_rnd_buffer_size = 2M</span>
datadir<span class="token operator">=</span>/usr/local/mysql/data
socket<span class="token operator">=</span>/usr/local/mysql/mysql.sock

<span class="token comment" spellcheck="true"># Disabling symbolic-links is recommended to prevent assorted security risks</span>
symbolic-links<span class="token operator">=</span>0

log-error<span class="token operator">=</span>/usr/local/mysql/logs/mysqld.log
pid-file<span class="token operator">=</span>/usr/local/mysql/pids/mysqld.pid                                       <span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="3-性能调优"><a href="#3-性能调优" class="headerlink" title="3.性能调优"></a>3.性能调优</h2><p>由于编译的时间是在太长了，这个地方的性能调优不涉及任何的sql优化，只针对一点：使用jemalloc来替换默认的内存管理<br>首先我们需要从网站上下载jemalloc，官网地址：<br><a target="_blank" rel="noopener" href="http://www.canonware.com/jemalloc/">http://www.canonware.com/jemalloc/</a></p><p>从github上可以下载最新的源码：<br><a target="_blank" rel="noopener" href="https://github.com/jemalloc/jemalloc/releases">https://github.com/jemalloc/jemalloc/releases</a></p><p>编译jemalloc：</p><pre class="line-numbers language-bash"><code class="language-bash">./configure --libdir<span class="token operator">=</span>/usr/local/lib
<span class="token function">make</span>
<span class="token function">make</span> <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><p>为了保证能够找到jemalloc库，我们需要设置一下库路径，</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token keyword">echo</span> <span class="token string">"/usr/local/lib"</span> <span class="token operator">></span> /etc/ld.so.conf.d/usr_local_lib.conf
ldconfig //执行这个命令可以刷新库路径<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>我们有两种方式来使用jemalloc来优化mysql<br>在编译的时候加入参数：</p><pre class="line-numbers language-bash"><code class="language-bash">-DCMAKE_EXE_LINKER_FLAGS<span class="token operator">=</span><span class="token string">"-ljemalloc"</span> -DWITH_SAFEMALLOC<span class="token operator">=</span>OFF<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>然后重新编译一遍。<br>也可以修改 /usr/local/mysql/bin/mysqld_safe<br>在# executing mysqld_safe 下面加上</p><pre class="line-numbers language-bash"><code class="language-bash">LD_PRELOAD<span class="token operator">=</span>/usr/local/lib/libjemalloc.so<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="4-其它配置"><a href="#4-其它配置" class="headerlink" title="4.其它配置"></a>4.其它配置</h2><p>通常我们需要重启服务器，最好在重启服务器的时候就启动mysql</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">cp</span> support-files/mysql.server /etc/init.d/mysqld
<span class="token function">chmod</span> a+x /etc/init.d/mysqld <span class="token comment" spellcheck="true">#需要root权限</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><p>然后将mysql添加到环境变量，修改/etc/profile文件</p><pre class="line-numbers language-bash"><code class="language-bash">vim /etc/profile   <span class="token comment" spellcheck="true">#需要root</span>
<span class="token comment" spellcheck="true">#在文件的最后面加入</span>
<span class="token comment" spellcheck="true">#mysql path</span>
<span class="token function">export</span> PATH<span class="token operator">=</span>/usr/local/mysql/bin:/usr/local/mysql/lib:<span class="token variable">$PATH</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>最后执行 <code>source /etc/profile</code></p><p>随后我们也需要多数据库进行初始化操作。自 mysql5.7 开始，初始化系统表不再使用 mysql_install_db 工具, 而是使用 mysqld –initialize-insecure –user=mysql , 其中 –initialize 表示默认生成一个安全的密码, –initialize-insecure 表示不生成密码, 密码为空</p><pre class="line-numbers language-bash"><code class="language-bash">mysqld --initialize-insecure --user<span class="token operator">=</span>mysql --basedir<span class="token operator">=</span>/usr/local/mysql --datadir<span class="token operator">=</span>/usr/local/mysql/data<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>现在可以启动mysql 服务器：</p><pre class="line-numbers language-bash"><code class="language-bash"><span class="token function">chkconfig</span> mysqld on<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>最后我们将root密码修改一下：</p><pre class="line-numbers language-bash"><code class="language-bash">mysql -u root
mysql<span class="token operator">></span> use mysql<span class="token punctuation">;</span>
mysql<span class="token operator">></span>update user <span class="token keyword">set</span> authentication_string<span class="token operator">=</span>password<span class="token punctuation">(</span><span class="token string">'123456'</span><span class="token punctuation">)</span> where user<span class="token operator">=</span><span class="token string">'root'</span> and Host <span class="token operator">=</span> <span class="token string">'localhost'</span><span class="token punctuation">;</span>
mysql<span class="token operator">></span> FLUSH PRIVILEGES<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><p>特别提醒注意的一点是，新版的mysql数据库下的user表中已经没有Password字段了</p><p>而是将加密后的用户密码存储于authentication_string字段</p><h2 id="5-tips"><a href="#5-tips" class="headerlink" title="5.tips"></a>5.tips</h2><p>执行make命令的时候可以加-j（多进程）参数来加快编译速度<br>make -j “cpu 核数”</p><p>比如已知CPU是4核心的，可以使用：<br>make -j 4</p></div><div id="side-right-bar"><div class="close-right-bar"></div><div class="sidebar-toc"><div class="sidebar-toc__title">目录</div><div class="sidebar-toc__progress"><span class="progress-notice">你已经阅读了</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar"></div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%87%86%E5%A4%87%E5%B7%A5%E4%BD%9C"><span class="toc-number">1.</span> <span class="toc-text">1.准备工作</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%87%86%E5%A4%87%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">2.准备安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E6%80%A7%E8%83%BD%E8%B0%83%E4%BC%98"><span class="toc-number">3.</span> <span class="toc-text">3.性能调优</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E5%85%B6%E5%AE%83%E9%85%8D%E7%BD%AE"><span class="toc-number">4.</span> <span class="toc-text">4.其它配置</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-tips"><span class="toc-number">5.</span> <span class="toc-text">5.tips</span></a></li></ol></div></div></div><div class="right-btn" id="right-btn"><span>目录</span></div><div class="article-bottom"><div class="addthis_inline_share_toolbox fr"></div></div><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者:</span><span class="post-copyright-info"><a href="mailto:undefined">CavinHuang</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接:</span><span class="post-copyright-info"><a target="_blank" rel="noopener" href="http://blog.zukmb.cnposts/c8b87153/">http://blog.zukmb.cn/posts/c8b87153/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明:</span><span class="post-copyright-info">转载请注明来自<a href="http://blog.zukmb.cn" target="_blank" style="font-size: 18px;">CavinHuangのBlog</a>！</span></div></div><div class="article-pagenate"><div class="article-prev fl"><span>←</span><a href="/posts/b745fdb3/">Centos7硬盘挂载方法</a></div><div class="article-next fr"><a href="/posts/40a075d8/">git push出现git remote: error: hook declined to update</a><span>→</span></div></div></article></div><footer class="footer"><div id="toTop" style="display: none;">Back to Top</div><div class="footer-content"><p>©2015 - 2018 By cavinHuang</p><div class="framework-info"><span>Driven -</span> <a target="_blank" rel="noopener" href="https://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme -</span> <a href=""><span>yoyo</span></a></div><div class="site-count"><ul><div class="site-count-item"><span id="busuanzi_container_site_pv">本站总访问量<span id="busuanzi_value_site_pv"></span>次</span></div><div class="site-count-item"><span id="busuanzi_container_site_uv">本站访客数<span id="busuanzi_value_site_uv"></span>人次</span></div></ul></div></div></footer><script>(function(){
var bp = document.createElement('script');
var curProtocol = window.location.protocol.split(':')[0];
if (curProtocol === 'https') {
bp.src = 'https://zz.bdstatic.com/linksubmit/push.js';
}
else {
bp.src = 'http://push.zhanzhang.baidu.com/push.js';
}
var s = document.getElementsByTagName("script")[0];
s.parentNode.insertBefore(bp, s);
})();
</script><script>(function(){
var src = (document.location.protocol == "http:") ? "http://js.passport.qihucdn.com/11.0.1.js?e055b4dda1d8e03e86cb32d91596a2c5":"https://jspassport.ssl.qhimg.com/11.0.1.js?e055b4dda1d8e03e86cb32d91596a2c5";
document.write('<script src="' + src + '" id="sozz"><\\/script>');
})();
</script><script async="" src="https://www.googletagmanager.com/gtag/js?id=UA-124916034-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-124916034-1');</script></div></div><canvas class="fireworks"></canvas><script src="/js/velocity.ui.min.js"></script><script src="/js/yoyo.js"></script><script src="/js/scroll.js"></script><script src="/js/anime.min.js"></script><script src="/js/fireworks.js"></script><script src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>